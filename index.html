<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pulse Protocol — Пульс рынка под контролем</title>
  <meta name="description" content="Алгоритмический DeFi протокол на циклах. Ликвидность с рыночными процентами. TradingView индикатор и e-mail сигналы." />
  <link rel="icon" type="image/png" href="/public/assets/favicon.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="bg-bg text-text font-inter">
  <header class="container mx-auto px-6 py-6 flex items-center justify-between">
    <img src="/public/assets/logo_pulse.svg" alt="Pulse Protocol" class="h-9">
    <div class="flex items-center gap-4">
      <button
        id="mobile-menu-button"
        type="button"
        class="md:hidden inline-flex h-11 w-11 items-center justify-center rounded-xl border border-grid text-muted transition hover:text-text hover:border-accent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-surface"
        aria-label="Открыть меню"
        aria-controls="mobile-menu-panel"
        aria-expanded="false"
        aria-haspopup="dialog"
      >
        <span class="sr-only">Открыть меню</span>
        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <line x1="4" y1="7" x2="20" y2="7" stroke-linecap="round"></line>
          <line x1="4" y1="12" x2="20" y2="12" stroke-linecap="round"></line>
          <line x1="4" y1="17" x2="20" y2="17" stroke-linecap="round"></line>
        </svg>
      </button>
      <nav class="hidden md:flex items-center gap-6 text-muted">
        <a href="#how" class="hover:text-text">Как работает</a>
        <a href="#apr" class="hover:text-text">Доходность</a>
        <a href="#faq" class="hover:text-text">FAQ</a>
        <a href="#app" class="ml-2 inline-block bg-accent text-bg font-extrabold px-5 py-3 rounded-xl hover:opacity-90 transition">Запустить dApp</a>
      </nav>
    </div>
  </header>
  <div id="crypto-ticker" class="ticker-container">
    <div id="ticker-content" class="ticker-content"></div>
  </div>
  <div id="mobile-menu" class="fixed inset-0 z-50 hidden md:hidden" aria-hidden="true">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" data-menu-overlay></div>
    <div
      id="mobile-menu-panel"
      class="relative ml-auto flex h-full w-full max-w-xs flex-col border-l border-grid bg-surface shadow-card"
      role="dialog"
      aria-modal="true"
      aria-labelledby="mobile-menu-title"
      tabindex="-1"
    >
      <div class="flex items-center justify-between border-b border-grid px-6 py-5">
        <h2 id="mobile-menu-title" class="text-lg font-semibold text-text">Навигация</h2>
        <button
          type="button"
          class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-grid text-muted transition hover:text-text hover:border-accent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-surface"
          aria-label="Закрыть меню"
          data-menu-close
        >
          <span class="sr-only">Закрыть меню</span>
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <line x1="6" y1="6" x2="18" y2="18" stroke-linecap="round"></line>
            <line x1="18" y1="6" x2="6" y2="18" stroke-linecap="round"></line>
          </svg>
        </button>
      </div>
      <nav class="flex flex-col gap-2 px-6 py-6 text-base text-muted">
        <a href="#how" class="rounded-lg px-3 py-2 transition hover:text-text focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-surface">Как работает</a>
        <a href="#apr" class="rounded-lg px-3 py-2 transition hover:text-text focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-surface">Доходность</a>
        <a href="#faq" class="rounded-lg px-3 py-2 transition hover:text-text focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-surface">FAQ</a>
        <a href="#app" class="mt-2 inline-flex items-center justify-center rounded-xl bg-accent px-4 py-3 text-sm font-extrabold uppercase tracking-wide text-bg transition hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-surface">Запустить dApp</a>
      </nav>
    </div>
  </div>
  <main class="container mx-auto px-6">
    <section class="py-16 md:py-24" data-hero>
      <h1 class="text-4xl md:text-6xl font-extrabold leading-tight max-w-4xl" data-hero-item>Пульс рынка под контролем</h1>
      <p class="text-muted mt-4 max-w-3xl" data-hero-item>
        Алгоритм на циклах и капитализации торгует от имени пула ликвидности.
        Пока средства в протоколе — вы получаете рыночные проценты.
      </p>
      <div class="mt-6 flex gap-3" data-hero-item>
        <a href="#deposit" class="bg-accent text-bg font-extrabold px-6 py-3 rounded-xl hover:opacity-90 transition">Вложить ликвидность</a>
        <a href="#lore" class="bg-accent2 text-white font-extrabold px-6 py-3 rounded-xl hover:opacity-90 transition">Читать лор</a>
      </div>
    </section>
    <section id="how" class="scroll-mt-24 border-t border-grid/60 py-16 md:py-24">
      <div class="max-w-3xl">
        <h2 class="text-3xl md:text-4xl font-extrabold">Как это работает</h2>
        <p class="mt-4 text-lg text-muted md:text-xl">Pulse Protocol создаётся, чтобы превратить рыночные циклы в настраиваемый, прозрачный и доступный поток дохода.</p>
      </div>
      <div class="mt-10 grid gap-6 md:grid-cols-3">
        <div class="card p-6">
          <span class="text-xs uppercase tracking-wide text-accent">Шаг 1</span>
          <h3 class="mt-3 text-xl font-semibold">Анализ циклов рынка</h3>
          <p class="mt-3 text-sm leading-relaxed text-muted">Используются капитализация, волатильность и ритмы рынка.</p>
        </div>
        <div class="card p-6">
          <span class="text-xs uppercase tracking-wide text-accent">Шаг 2</span>
          <h3 class="mt-3 text-xl font-semibold">Алготрейдинг</h3>
          <p class="mt-3 text-sm leading-relaxed text-muted">Протокол автоматически совершает сделки от имени пула.</p>
        </div>
        <div class="card p-6">
          <span class="text-xs uppercase tracking-wide text-accent">Шаг 3</span>
          <h3 class="mt-3 text-xl font-semibold">Рыночные проценты</h3>
          <p class="mt-3 text-sm leading-relaxed text-muted">Пока ликвидность в пуле — начисляется доход.</p>
        </div>
      </div>
    </section>
    <section id="apr" class="scroll-mt-24 border-t border-grid/60 py-16 md:py-24">
      <div class="max-w-3xl">
        <h2 class="text-3xl md:text-4xl font-extrabold">Доходность (APR)</h2>
        <p class="mt-4 text-muted">Выбирайте пул по доходности и риску. Доступны USDT, ETH, BTC.</p>
      </div>
      <div class="mt-10 grid gap-6 md:grid-cols-3">
        <article class="card p-6">
          <h3 class="text-xl font-semibold">USDT пул — 6–8% APR</h3>
          <p class="mt-3 text-sm text-muted">Ликвидность: $— · Риск: низкий</p>
          <p class="mt-4 text-sm leading-relaxed text-muted">Действия: «Вложить» · «Подробнее».</p>
        </article>
        <article class="card p-6">
          <h3 class="text-xl font-semibold">ETH пул — 4–6% APR</h3>
          <p class="mt-3 text-sm text-muted">Ликвидность: $— · Риск: средний</p>
          <p class="mt-4 text-sm leading-relaxed text-muted">Действия: «Вложить» · «Подробнее».</p>
        </article>
        <article class="card p-6">
          <h3 class="text-xl font-semibold">BTC пул — 3–5% APR</h3>
          <p class="mt-3 text-sm text-muted">Ликвидность: $— · Риск: средний</p>
          <p class="mt-4 text-sm leading-relaxed text-muted">Действия: «Вложить» · «Подробнее».</p>
        </article>
      </div>
      <p class="mt-6 text-sm text-muted italic">Примечание: значения примерные для макета.</p>
    </section>
    <section id="deposit" class="scroll-mt-24 border-t border-grid/60 py-16 md:py-24">
      <div class="grid gap-10 lg:grid-cols-[1.4fr,1fr]">
        <div>
          <h2 class="text-3xl md:text-4xl font-extrabold">Мой депозит</h2>
          <p class="mt-4 text-muted">Баланс, начисления и действия «Пополнить/Вывести» собраны в одном месте, чтобы депозит всегда был под контролем.</p>
          <div class="mt-8 grid gap-4 sm:grid-cols-2">
            <div class="card p-5">
              <span class="text-xs uppercase tracking-wide text-muted">Депозит</span>
              <p class="mt-2 text-2xl font-semibold">$—</p>
            </div>
            <div class="card p-5">
              <span class="text-xs uppercase tracking-wide text-muted">Доход YTD</span>
              <p class="mt-2 text-2xl font-semibold">— %</p>
            </div>
            <div class="card p-5">
              <span class="text-xs uppercase tracking-wide text-muted">Награды</span>
              <p class="mt-2 text-2xl font-semibold">$—</p>
            </div>
            <div class="card p-5">
              <span class="text-xs uppercase tracking-wide text-muted">Комиссии</span>
              <p class="mt-2 text-2xl font-semibold">$—</p>
            </div>
          </div>
          <p class="mt-6 text-sm leading-relaxed text-muted">Действия: «Пополнить» · «Вывести» · «История».</p>
          <p class="mt-4 text-sm leading-relaxed text-muted">Вывод ликвидности возможен в любой момент при доступности пула.</p>
          <a href="#app" class="mt-6 inline-flex items-center justify-center rounded-xl bg-accent px-6 py-3 font-extrabold text-bg transition hover:opacity-90">Перейти к приложению</a>
        </div>
        <div class="space-y-6">
          <div class="card p-6">
            <h3 class="text-lg font-semibold">Процент на стороне пула</h3>
            <p class="mt-3 text-sm leading-relaxed text-muted">Пока ликвидность в протоколе — вы получаете рыночные проценты, рассчитанные алгоритмом на циклах и капитализации.</p>
          </div>
          <div class="card p-6">
            <h3 class="text-lg font-semibold">Доступ к аналитике</h3>
            <p class="mt-3 text-sm leading-relaxed text-muted">TradingView индикатор и e-mail уведомления помогают отслеживать сигналы входа и выхода.</p>
          </div>
        </div>
      </div>
    </section>
    <section id="app" class="scroll-mt-24 border-t border-grid/60 py-16 md:py-24">
      <div class="grid gap-10 lg:grid-cols-[1.4fr,1fr]">
        <div>
          <h2 class="text-3xl md:text-4xl font-extrabold">Интерфейс dApp</h2>
          <p class="mt-4 text-muted">Вкладки «Пулы», «Мой депозит» и «История» помогают управлять ликвидностью, следить за начислениями и действиями.</p>
          <div class="mt-8 space-y-4">
            <div class="card p-5">
              <h3 class="text-lg font-semibold">Пулы</h3>
              <p class="mt-2 text-sm leading-relaxed text-muted">Обзор всех пулов с фильтрами и сортировкой по APR.</p>
            </div>
            <div class="card p-5">
              <h3 class="text-lg font-semibold">Мой депозит</h3>
              <p class="mt-2 text-sm leading-relaxed text-muted">Баланс, начисления и быстрые действия «Пополнить/Вывести».</p>
            </div>
            <div class="card p-5">
              <h3 class="text-lg font-semibold">История</h3>
              <p class="mt-2 text-sm leading-relaxed text-muted">Транзакции пополнений, выводов и наград фиксируются в одном журнале.</p>
            </div>
          </div>
          <a href="/dapp/пульс/" class="mt-8 inline-flex items-center justify-center rounded-xl bg-accent px-6 py-3 font-extrabold text-bg transition hover:opacity-90">Открыть интерфейс</a>
        </div>
        <div class="card p-6">
          <h3 class="text-lg font-semibold">Автоматизация сигналов</h3>
          <p class="mt-3 text-sm leading-relaxed text-muted">
            Вместо почтовых рассылок используйте входящий webhook, чтобы передавать сигналы в Zapier, Make или другие сервисы
            автоматизации. Endpoint принимает JSON и сразу же проксирует событие.
          </p>
          <div class="mt-4 flex flex-col gap-3 sm:flex-row">
            <span
              id="webhook-url"
              data-webhook-path="/api/zapier-hook"
              class="inline-flex items-center justify-between rounded-xl border border-grid/50 bg-surface/80 px-4 py-3 text-xs font-semibold uppercase tracking-wide text-muted"
            >
              /api/zapier-hook
            </span>
            <button
              id="copy-webhook-button"
              type="button"
              class="inline-flex items-center justify-center rounded-xl bg-accent px-6 py-3 font-extrabold text-bg transition hover:opacity-90"
            >
              Скопировать URL
            </button>
          </div>
          <p class="mt-3 text-xs uppercase tracking-wide text-muted">
            Webhook не сохраняет персональные данные: он принимает уведомление от индикатора и мгновенно пересылает его в
            выбранный сценарий автоматизации.
          </p>
          <ol class="mt-4 space-y-2 text-sm leading-relaxed text-muted list-decimal list-inside">
            <li>Создайте Zap и выберите триггер <em>Webhooks by Zapier → Catch Hook</em>.</li>
            <li>Скопируйте URL, вставьте его в Zapier и отправьте тестовый сигнал для проверки.</li>
            <li>Добавьте действие: Slack, Sheets, Discord, e-mail или любой другой поддерживаемый сервис.</li>
          </ol>
        </div>
      </div>
    </section>
    <section id="lore" class="scroll-mt-24 border-t border-grid/60 py-16 md:py-24">
      <div class="card mx-auto max-w-4xl p-8">
        <h2 class="text-3xl md:text-4xl font-extrabold">Лор проекта</h2>
        <p class="mt-4 text-lg leading-relaxed text-muted">Pulse Protocol — сердце децентрализованного рынка. Оно улавливает ритм капитализации и превращает каждое сокращение в поток дохода.</p>
        <p class="mt-4 text-lg leading-relaxed text-muted">Алгоритм работает непрерывно, а ликвидность пользователей остаётся в безопасности смарт-контрактов.</p>
      </div>
    </section>
    <section id="faq" class="scroll-mt-24 border-t border-grid/60 py-16 md:py-24">
      <div class="max-w-3xl">
        <h2 class="text-3xl md:text-4xl font-extrabold">FAQ</h2>
        <p class="mt-4 text-muted">Мы собрали короткие ответы на частые вопросы о доходности, ликвидности и уведомлениях.</p>
      </div>
      <div class="mt-10 space-y-4">
        <div class="card p-6">
          <button type="button" class="flex w-full items-center justify-between gap-6 text-left" data-accordion-trigger aria-expanded="true" aria-controls="faq-panel-1" id="faq-trigger-1">
            <span class="text-lg font-semibold">Как начисляются проценты?</span>
            <svg data-accordion-icon class="h-5 w-5 shrink-0 rotate-180 text-accent transition-transform duration-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
            </svg>
          </button>
          <div id="faq-panel-1" class="mt-4 text-sm leading-relaxed text-muted" role="region" aria-labelledby="faq-trigger-1" aria-hidden="false">
            <p>Проценты начисляются динамически в соответствии с рынком, пока ликвидность остаётся в пуле.</p>
          </div>
        </div>
        <div class="card p-6">
          <button type="button" class="flex w-full items-center justify-between gap-6 text-left" data-accordion-trigger aria-expanded="false" aria-controls="faq-panel-2" id="faq-trigger-2">
            <span class="text-lg font-semibold">Можно ли вывести ликвидность?</span>
            <svg data-accordion-icon class="h-5 w-5 shrink-0 text-accent transition-transform duration-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
            </svg>
          </button>
          <div id="faq-panel-2" class="mt-4 hidden text-sm leading-relaxed text-muted" role="region" aria-labelledby="faq-trigger-2" aria-hidden="true">
            <p>Вывод ликвидности возможен в любой момент, когда пул доступен, без блокировок средств.</p>
          </div>
        </div>
        <div class="card p-6">
          <button type="button" class="flex w-full items-center justify-between gap-6 text-left" data-accordion-trigger aria-expanded="false" aria-controls="faq-panel-3" id="faq-trigger-3">
            <span class="text-lg font-semibold">Как приходят сигналы?</span>
            <svg data-accordion-icon class="h-5 w-5 shrink-0 text-accent transition-transform duration-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
            </svg>
          </button>
          <div id="faq-panel-3" class="mt-4 hidden text-sm leading-relaxed text-muted" role="region" aria-labelledby="faq-trigger-3" aria-hidden="true">
            <p>Сигналы отображаются на графике индикатора и дублируются на e-mail с подробностями входа.</p>
          </div>
        </div>
        <div class="card p-6">
          <button type="button" class="flex w-full items-center justify-between gap-6 text-left" data-accordion-trigger aria-expanded="false" aria-controls="faq-panel-4" id="faq-trigger-4">
            <span class="text-lg font-semibold">Что доступно в приложении?</span>
            <svg data-accordion-icon class="h-5 w-5 shrink-0 text-accent transition-transform duration-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
            </svg>
          </button>
          <div id="faq-panel-4" class="mt-4 hidden text-sm leading-relaxed text-muted" role="region" aria-labelledby="faq-trigger-4" aria-hidden="true">
            <p>Вкладки «Пулы», «Мой депозит» и «История» дают доступ к доходности, балансу и журналу транзакций.</p>
          </div>
        </div>
      </div>
    </section>
    <section id="indicator" class="py-16 md:py-24 space-y-10">
      <div class="grid gap-6 lg:grid-cols-[2fr,1fr]">
        <div class="card p-6">
          <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
            <div>
              <h2 class="text-2xl font-bold">Индикатор Pulse Protocol</h2>
              <p id="indicator-subtitle" class="text-sm text-muted mt-2">—</p>
            </div>
            <div class="text-right">
              <div class="text-xs uppercase tracking-wide text-muted">Актив</div>
              <div id="indicator-symbol" class="text-2xl font-extrabold">—</div>
            </div>
          </div>
          <div class="mt-6 h-[320px] md:h-[420px]" id="chart-root"></div>
          <div id="coin-summary-card" class="card mt-6 coin-summary">
            <div class="coin-summary__header">
              <div>
                <div class="coin-summary__label">Монета</div>
                <div id="coin-summary-asset" class="coin-summary__asset">—</div>
              </div>
              <div class="coin-summary__price-block">
                <div id="coin-summary-price" class="coin-summary__price">—</div>
                <div id="coin-summary-change" class="coin-summary__change">—</div>
              </div>
            </div>
            <div class="coin-summary__meta">
              <span id="coin-summary-timeframe">Таймфрейм —</span>
              <span id="coin-summary-updated">Обновлено —</span>
              <span id="coin-summary-coin">CoinGecko ID —</span>
            </div>
            <div class="coin-summary__grid">
              <div class="coin-summary__metric">
                <div class="coin-summary__metric-label">Тип сигнала</div>
                <div id="coin-summary-signal-type" class="coin-summary__metric-value text-muted">—</div>
              </div>
              <div class="coin-summary__metric">
                <div class="coin-summary__metric-label">Цена входа</div>
                <div id="coin-summary-entry" class="coin-summary__metric-value">—</div>
              </div>
              <div class="coin-summary__metric">
                <div class="coin-summary__metric-label">R/R</div>
                <div id="coin-summary-rr" class="coin-summary__metric-value">—</div>
              </div>
              <div class="coin-summary__metric">
                <div class="coin-summary__metric-label">Take-profit</div>
                <div id="coin-summary-take-profit" class="coin-summary__metric-value">—</div>
              </div>
              <div class="coin-summary__metric">
                <div class="coin-summary__metric-label">Stop-loss</div>
                <div id="coin-summary-stop-loss" class="coin-summary__metric-value">—</div>
              </div>
              <div class="coin-summary__metric">
                <div class="coin-summary__metric-label">Время сигнала</div>
                <div id="coin-summary-signal-time" class="coin-summary__metric-value">—</div>
              </div>
            </div>
          </div>
        </div>
        <div class="space-y-6">
          <div class="card p-6">
            <h3 class="text-lg font-semibold">Активные сигналы</h3>
            <ul id="signals-list" class="mt-4 space-y-4"></ul>
          </div>
          <div class="card p-6">
            <div class="flex flex-col gap-2">
              <div class="flex flex-wrap items-center justify-between gap-3">
                <h3 class="text-lg font-semibold">Детали сигнала</h3>
                <span id="automation-status-badge" class="badge hidden">—</span>
              </div>
              <p id="automation-status" class="text-xs uppercase tracking-wide text-muted hidden"></p>
              <div
                id="automation-port-indicator"
                class="port-indicator hidden"
                aria-live="polite"
              ></div>
            </div>
            <div id="signal-details" class="mt-4 text-sm leading-relaxed text-muted">Выберите сигнал, чтобы увидеть рыночный контекст и уровни управления риском.</div>
          </div>
        </div>
      </div>
      <div class="grid gap-4 md:grid-cols-3" id="metrics-grid"></div>
    </section>
  </main>
  <footer class="border-t border-grid mt-10">
    <div class="container mx-auto px-6 py-8 text-sm text-muted flex flex-col md:flex-row items-center justify-between gap-4">
      <div>© 2025 Pulse Protocol</div>
      <nav class="flex gap-5">
        <a href="#" class="hover:text-text">Docs</a>
        <a href="#" class="hover:text-text">GitHub</a>
        <a href="#" class="hover:text-text">Twitter</a>
        <a href="#" class="hover:text-text">Discord</a>
      </nav>
    </div>
  </footer>
  <script type="module">
    const openButton = document.getElementById('mobile-menu-button');
    const menuContainer = document.getElementById('mobile-menu');

    if (!openButton || !menuContainer) {
      console.warn('Элементы мобильного меню не найдены.');
    } else {
      const overlay = menuContainer.querySelector('[data-menu-overlay]');
      const closeButton = menuContainer.querySelector('[data-menu-close]');
      const menuLinks = Array.from(menuContainer.querySelectorAll('a'));
      const focusableSelector = 'a[href]:not([tabindex="-1"]), button:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])';
      let lastFocusedElement = null;

      const setExpandedState = (isOpen) => {
        openButton.setAttribute('aria-expanded', String(isOpen));
        menuContainer.setAttribute('aria-hidden', String(!isOpen));
      };

      const getFocusableElements = () =>
        Array.from(menuContainer.querySelectorAll(focusableSelector)).filter(
          (element) =>
            !element.hasAttribute('disabled') &&
            element.getAttribute('aria-hidden') !== 'true' &&
            element.getClientRects().length > 0
        );

      const trapFocus = (event) => {
        if (event.key !== 'Tab') return;

        const focusableElements = getFocusableElements();
        if (focusableElements.length === 0) return;

        const firstElement = focusableElements[0];
        const lastElement = focusableElements[focusableElements.length - 1];
        const isShiftPressed = event.shiftKey;
        const activeElement = document.activeElement;

        if (isShiftPressed) {
          if (activeElement === firstElement || !menuContainer.contains(activeElement)) {
            event.preventDefault();
            lastElement.focus();
          }
        } else if (activeElement === lastElement) {
          event.preventDefault();
          firstElement.focus();
        }
      };

      const closeMenu = ({ restoreFocus = true } = {}) => {
        if (menuContainer.classList.contains('hidden')) return;

        menuContainer.classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
        setExpandedState(false);
        document.removeEventListener('keydown', handleKeydown);

        if (restoreFocus && lastFocusedElement instanceof HTMLElement) {
          lastFocusedElement.focus();
        }
      };

      const handleKeydown = (event) => {
        if (event.key === 'Escape') {
          event.preventDefault();
          closeMenu();
          return;
        }

        trapFocus(event);
      };

      const openMenu = () => {
        lastFocusedElement = document.activeElement;
        menuContainer.classList.remove('hidden');
        document.body.classList.add('overflow-hidden');
        setExpandedState(true);

        document.addEventListener('keydown', handleKeydown);

        const focusableElements = getFocusableElements();
        if (focusableElements.length > 0) {
          focusableElements[0].focus();
        }
      };

      openButton.addEventListener('click', () => {
        if (menuContainer.classList.contains('hidden')) {
          openMenu();
        } else {
          closeMenu();
        }
      });

      closeButton?.addEventListener('click', () => closeMenu());
      overlay?.addEventListener('click', () => closeMenu());
      menuLinks.forEach((link) => link.addEventListener('click', () => closeMenu({ restoreFocus: false })));

      const mediaQuery = window.matchMedia('(min-width: 768px)');
      const handleMediaChange = (event) => {
        if (event.matches) {
          closeMenu({ restoreFocus: false });
        }
      };

      if (typeof mediaQuery.addEventListener === 'function') {
        mediaQuery.addEventListener('change', handleMediaChange);
      } else if (typeof mediaQuery.addListener === 'function') {
        mediaQuery.addListener(handleMediaChange);
      }
    }

    const webhookUrlElement = document.getElementById('webhook-url');
    const copyWebhookButton = document.getElementById('copy-webhook-button');

    if (webhookUrlElement) {
      const path = webhookUrlElement.dataset.webhookPath || webhookUrlElement.textContent?.trim() || '/api/zapier-hook';
      let absoluteUrl = path;

      try {
        absoluteUrl = new URL(path, window.location.origin).href;
      } catch (error) {
        console.warn('Не удалось сформировать абсолютный URL webhook', error);
      }

      webhookUrlElement.textContent = path;
      webhookUrlElement.setAttribute('data-webhook-url', absoluteUrl);
      webhookUrlElement.setAttribute('title', absoluteUrl);
    }

    if (copyWebhookButton && webhookUrlElement) {
      const defaultText = copyWebhookButton.textContent?.trim() || 'Скопировать URL';

      const resetButtonState = () => {
        copyWebhookButton.textContent = defaultText;
        copyWebhookButton.classList.remove('opacity-80');
        copyWebhookButton.removeAttribute('data-copy-state');
      };

      copyWebhookButton.addEventListener('click', async () => {
        if (copyWebhookButton.dataset.copyState === 'pending') {
          return;
        }

        const value = webhookUrlElement.dataset.webhookUrl || webhookUrlElement.textContent || '';
        if (!value) {
          return;
        }

        copyWebhookButton.dataset.copyState = 'pending';

        const restoreLater = () => {
          window.setTimeout(resetButtonState, 2200);
        };

        try {
          if (navigator.clipboard?.writeText) {
            await navigator.clipboard.writeText(value);
          } else {
            const fallbackInput = document.createElement('input');
            fallbackInput.value = value;
            fallbackInput.setAttribute('readonly', '');
            fallbackInput.style.position = 'fixed';
            fallbackInput.style.opacity = '0';
            fallbackInput.style.pointerEvents = 'none';
            document.body.append(fallbackInput);
            fallbackInput.select();
            document.execCommand('copy');
            fallbackInput.remove();
          }

          copyWebhookButton.textContent = 'Скопировано';
          copyWebhookButton.classList.add('opacity-80');
          restoreLater();
        } catch (error) {
          console.error('Не удалось скопировать webhook URL', error);
          copyWebhookButton.textContent = 'Ошибка копирования';
          copyWebhookButton.classList.add('opacity-80');
          restoreLater();
        }
      });
    }
  </script>
  <script type="module" src="/dapp/пульс/src/main.js"></script>
</body>
</html>