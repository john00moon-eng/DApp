---
title: "Документация"
description: "Введение, протокол, индикатор, API, интеграции, безопасность."
slug: "/docs"
---

# Документация

## Оглавление
- [Введение](#intro)  
- [Устройство протокола](#protocol)  
- [Индикатор](#indicator)  
- [API сигналов](#api)  
- [Интеграция с графиком](#charts)  
- [E-mail подписки](#email)  
- [Токеномика](#token) _(если применимо)_  
- [Безопасность и аудит](#security)

---

## Введение {#intro}
Что такое **Pulse Protocol**, ключевые понятия, ограничения и риски.

## Устройство протокола {#protocol}
Архитектура, роли, пулы ликвидности, комиссии, распределение наград.

## Индикатор {#indicator}
Установка в TradingView, параметры, примеры сигналов.

## API сигналов {#api}
`GET /api/signals?symbol=BTCUSDT&timeframe=1h` — формат ответа, поля, коды ошибок.

## Интеграция с графиком {#charts}
Lightweight Charts / TradingView widget, оверлей маркеров.

## E-mail подписки {#email}
`POST /api/subscribe-email` принимает адрес подписчика и подтверждает согласие на рассылку. Сигналы индикатора можно
дублировать на почту TradingView и переадресовывать в автоматизации.

### Шаблон алерта в TradingView
1. Откройте график с индикатором и нажмите **Alerts**.
2. В поле условий выберите нужный сигнал индикатора (например, `BUY`/`SELL` или Crossing по цене).
3. В блоке **Message** укажите структурированное сообщение, чтобы автоматизации могли разобрать его по полям.
4. В разделе способов доставки отметьте **Email**, укажите собственный адрес или специальный inbox Zapier.

Рекомендуемый шаблон сообщения:
```json
{
  "source": "pulse-protocol",
  "ticker": "{{ticker}}",
  "price": "{{close}}",
  "time": "{{time}}",
  "event": "{{plot_0}}"
}
```
Шаблон можно расширить дополнительными плейсхолдерами TradingView (временем, таймфреймом, ссылкой на график).

### Настройка цепочки Zapier {#zapier}
1. Создайте Zap и выберите триггер **Email Parser by Zapier** либо **Email** → **Inbound Email**. Сервис выдаст
уникальный адрес вида `yourname@zapiermail.com`.
2. Отправьте тестовое письмо из TradingView на этот адрес и разметьте его поля в Email Parser (тикер, цена, тип сигнала,
таймфрейм).
3. Добавьте фильтр Zapier, чтобы пропускать только нужные события (например, `event = BUY`).
4. Выберите действие: сообщение в Telegram/Slack, запись в Google Sheets/Notion, вызов Webhook или собственного API.
5. В качестве конечной точки вебхука используйте URL вашего деплоя Pulse Protocol: `https://<ваш-домен>/api/zapier-hook`. В шаге **Webhooks by Zapier** укажите заголовок `Authorization: Bearer <секрет>` (при необходимости можно добавить и `X-Zapier-Token: <секрет>`), чтобы ключ не попадал в URL.
6. При необходимости можно завести собственный промежуточный эндпоинт (proxy), который добавит секрет к запросу перед отправкой на `/api/zapier-hook`.
7. Включите Zap и проведите финальный тест — TradingView должен отправить письмо, поля корректно распознаваться, а действие
   запускаться без ошибок.

> ℹ️ Сервер автоматически проверяет переменную `ZAPIER_WEBHOOK_SECRET` (или устаревшую `ZAPIER_TOKEN`) только в заголовках `Authorization: Bearer` и `X-Zapier-Token`.

#### Как безопасно хранить и проверять секрет
1. Сгенерируйте длинный случайный токен (32–64 байт) и сохраните его в переменной окружения деплоя, например `ZAPIER_WEBHOOK_SECRET` в настройках Vercel.
2. На стороне Zapier передавайте этот токен только в заголовке `Authorization: Bearer <секрет>` или в пользовательском заголовке, который укажете в переменной `ZAPIER_TOKEN_HEADER`.
3. Если площадка не поддерживает пользовательские заголовки, используйте собственный прокси-эндпоинт, который добавит секрет перед пересылкой запроса на `/api/zapier-hook`.
4. Проверка на сервере может выглядеть так (пример Next.js API Route на Vercel):
   ```ts
   import type { NextApiRequest, NextApiResponse } from 'next';

   const secret = process.env.ZAPIER_WEBHOOK_SECRET ?? '';

   export default function handler(req: NextApiRequest, res: NextApiResponse) {
     if (req.method !== 'POST') {
       return res.status(405).json({ error: 'Method Not Allowed' });
     }

     const authHeader = req.headers.authorization ?? '';
     const token = authHeader.startsWith('Bearer ')
       ? authHeader.slice('Bearer '.length).trim()
       : '';

     if (!secret || token !== secret) {
       return res.status(401).json({ error: 'Unauthorized' });
     }

     // Дальнейшая обработка полезной нагрузки
     return res.status(202).json({ status: 'accepted' });
   }
   ```

### Проверка и безопасность
- Храните уникальный адрес Zapier в секрете, чтобы избежать спама.
- Для критичных сценариев используйте двусторонние подтверждения (например, Webhook → ваш сервер → биржа).
- Регулярно просматривайте журнал Zapier и TradingView Alerts на наличие ошибок и дубликатов.
- При необходимости ограничивайте частоту алертов и используйте отписку через `POST /api/subscribe-email`.

## Токеномика {#token}
(Опционально) эмиссия, утилити, распределение, вестинг.

## Безопасность и аудит {#security}
Best practices, апгрейд, ограничения, планы аудита.
